{% extends "base.html" %}
{% load i18n plmapp_tags %}

{% block css %}

    <link rel="stylesheet" href="/media/css/lifecycle.css" type="text/css" charset="utf-8" />
{% endblock css %}
<!-- Manage html display in the Content div which correspond to the "revisions" menu -->

{% block content %}
    {% if add_revision_form and obj.is_revisable %}
        <form id="form-revision" method="POST"
            {% if confirmation %} class="confirmation" {% endif %} action="">
            {{ add_revision_form }}
            {% if obj.is_document and confirmation %}
                <div id="form-revision-dialog"
                    title="{% trans "Are you sure?" %}"
                    {% if part_formset.is_bound and not part_formset.is_valid %} 
                        class="c-error action-{{ action }}"
                    {% endif %}
                    >
                    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>{% trans "Here is the list of parts connected to the original document. Do you want to connect them to new document?" %}</p>
                    <div class="parts">
                        {{ part_formset.management_form }}

                        <table class="Content">
                            {% for form in part_formset.forms %}
                                {{ form.id }}
                                {{ form.document }}

                                {{ form.part }}
                                <tr class="Content">
                                    {% with form.instance.part as part %}
                                        {% if part.is_editable %}
                                            <td class="Content" style="width:50px; text-align:center">{{ form.selected }}</td>
                                        {% else %}
                                            <td class="Content">-</td>
                                        {% endif %}
                                        <td class="Content">{{ part.type }}</td>
                                        <td class="Content">{{ part.reference }} </td>
                                        <td class="Content">{{ part.revision }}</td>
                                        <td class="Content">{{ part.name }}</td>
                                    {% endwith %}
                                </tr>
                            {% endfor %}
                        </table>

                    </div>
                </div>
            {% endif %}

            <input type="submit" class="{{"Button"|button}}" value="{% trans "NEW" %}"/>
        </form>
    {% else %}
        {% if is_readable %}
            {% trans "You can not revise this object since a revision already exist." %}
        {% endif %}
    {% endif %}
    <table class="Content">
        {% for object in revisions %}
            <tr class="Content">
                <td class="Content">
                    <a href="{{object.plmobject_url}}">{{object.reference}}</a>
                </td>
                <td class="Content">{{object.revision}}</td>
                <td class="Content">{{object.type}}</td>
                <td class="Content">{{object.state.name}}</td>
            </tr>	
        {% endfor %}
    </table>
{% endblock %}

