{% extends "base.html" %}
{% load i18n plmapp_tags %}

{% block scripts %}
    <script type="text/javascript" src="/media/js/jquery.showLoading.min.js"></script>
    <script type="text/javascript" src="/media/js/3D/ajax3D.js"></script>
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="/media/css/showLoading.css" type="text/css" media="screen" charset="utf-8" />

    <style type="text/css">
        table.Content tr.part td {
            background-color: #ccc;
            color: #000;
        }
        table.Content tr td.errors {
            background-color: #F03838;
            color: #000;
        }
        tr.extra_errors td {
            padding: 0.5em;
        }
        .toggle_extra_attributes_button span {
            width: 1em;
        }
        table.Content th.cell_label {
            width: 15em;
        }

    </style>

{% endblock %}

{% block content %}

    <form method="post" action="" id="decompose_form">

        {% csrf_token %} 
        {{ part_type_formset.management_form }}
        {{ bom_formset.management_form }}
        <div style="display:none;">
            {{last_time_modification}}
        </div>

        <table class="Content">

            <thead>
                <th>{% trans "Order" %}</th>
                <th>{% trans "Quantity" %}</th>
                <th>{% trans "Unit" %}</th>
                <th>{% trans "Type" %}</th>
                <th>{% trans "Reference" %} </th>
                <th>{% trans "Revision" %} </th>
                <th>{% trans "Name" %}  </th>
                <th>&nbsp;</th>
            </thead>

            {% if extra_errors %}
                <tr class="extra_errors">
                    <td class="errors" colspan="8">{{extra_errors}}</td>
                </tr>
            {% endif %}

            {% for type, part_doc_cforms, ord_qty in forms %} 


                <tr class="part"> 
                    <td class="order" >{{ord_qty.order}}{{ord_qty.order.errors }}</td>
                    <td class="quantity">{{ord_qty.quantity}}{{ord_qty.quantity.errors}}</td>
                    <td class="quantity">{{ord_qty.unit}}{{ord_qty.unit.errors}}</td>

                    <td class="cell_label part_type_form">
                        {{ type.type_part }}

                    </td>

                    {% for field in part_doc_cforms.0 %} 

                        {% if field.name == "reference" or field.name == "name" or field.name == "revision" %}
                            <td class="{{field.errors|yesno:"errors,valid"}}">
                                {{  field }} {{ field.errors }}
                            </td> 
                        {% endif %}

                    {% endfor %}

                    <td>
                        <button class="toggle_extra_attributes_button"
                            id="part_show{{forloop.counter0}}"
                            >{{part_doc_cforms.0.errors|yesno:"-,+"}}</button> 
                    </td>
                </tr>

                <tr class="part part_show{{forloop.counter0}} show_hide" 
                    {% if not part_doc_cforms.0.errors %} style="display:none;" {% endif %}
                    >

                    <td class="vide" colspan="3">
                    </td>
                    <td colspan="5" id="extra_part_form-{{forloop.counter0}}">
                        {% with part_doc_cforms.0 as creation_form %}
                            {% include "extra_attributes.html" %}
                        {% endwith %}
                    </td>

                </tr> 


                <tr class="document">
                    <td class="vide" colspan="3">
                    </td>

                    <td class="cell_label">
                        <p>Document3D</p>
                    </td>
                    {% for field in part_doc_cforms.1 %} 

                        {% if field.name == "reference" or field.name == "name" or field.name == "revision" %}
                            <td class="{{field.errors|yesno:"errors,valid"}}">
                                {{  field }} {{ field.errors }}
                            </td> 
                        {% endif %}

                    {% endfor %}

                    <td>
                        <button class="toggle_extra_attributes_button"
                            id="doc_show{{forloop.counter0}}"
                            >{{part_doc_cforms.1.errors|yesno:"-,+"}}</button> 
                    </td>

                </tr>

                <tr class="document doc_show{{forloop.counter0}} show_hide" 
                    {% if not part_doc_cforms.1.errors %} style="display:none;" {% endif %}
                    >

                    <td class="vide" colspan="3">
                    </td>
                    <td colspan="5">
                        {% with part_doc_cforms.1 as creation_form %}
                            {% include "extra_attributes.html" %}
                        {% endwith %}
                    </td>

                </tr> 


            {% endfor %} 

        </table> 
        <input type="submit" value="{% trans "Create" %}"/> 

    </form>       


{% endblock %}


