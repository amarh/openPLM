{% extends "base.html" %}
{% load i18n plmapp_tags %}

{% block scripts %}
    <script type="text/javascript" src="/media/js/jquery.showLoading.min.js"></script>
    <script type="text/javascript" src="/media/js/3D/ajax3D.js"></script>
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="/media/css/showLoading.css" type="text/css" media="screen" charset="utf-8" />

    <style type="text/css">
        table.Content tr.part td {
            background-color: #ccc;
            color: #000;
        }
        table.Content tr td.errors {
            background-color: #F03838;
            color: #000;
        }
        tr.extra_errors td {
            padding: 0.5em;
        }
        .toggle_extra_attributes_button span {
            width: 1em;
        }
        table.Content th.cell_label {
            width: 15em;
        }

    </style>

{% endblock %}

{% block content %}

    <form method="post" action="" id="decompose_form">

        {% csrf_token %} 

        <div style="display:none;">
            {{last_time_modification}}
        </div>
        
        <table class="Content">
        
        
        <thead>
            <th>{% trans "Assembly" %}</th>
            <th>{% trans "Child" %}</th>
            <th>{% trans "Order" %}</th>
            <th>{% trans "Quantity" %}</th>
            <th>{% trans "Unit" %}</th>
            <th>{% trans "Type" %}</th>
            <th>{% trans "Reference" %} </th>
            <th>{% trans "Revision" %} </th>
            <th>{% trans "Name" %}  </th>
            <th>&nbsp;</th>
        </thead>
        
        {% if extra_errors %}
            <tr class="extra_errors">
                <td class="errors" colspan="10">{{extra_errors}}</td>
            </tr>
        {% endif %}
        {% for deep in deep_assemblys %} 
        

        <tr class="assembly"> 
            <td class="assembly_name" id="{{assembly.1}}" colspan="10">

                {{forloop.counter0}}

            </td>        
        
                
        {% for assembly in deep %}       <!-- assembly.0 froms ,  assembly.1 name , assembly.2 interne reference pour href links -->                  
  
            
            
            <tr class="assembly"> 
            <td class="assembly_name" id="{{assembly.1}}" colspan="10">

                {{assembly.1}}
                      
                <a id="{{assembly.2}}_part">
                
                (Part) <!-- type de part de la part  -->
                </a>

            </td>

            </tr> 
            
            


            </tr>  
           
                {% for part_type , ord_quantity , part_doc_cforms, name , is_assembly , prefix , ref  in assembly.0 %} 
                

                    <tr class="part">
                    
                    
                    
                        <td class="|->">
                        <!--esthetique -->
                        {%if not prefix and forloop.last %}
                        
                        -> 
                        {% else %}
                        
                        
                        {% if not forloop.last or forloop.first %} 
                         |->
                        {% else %}
                        ->                        
                        {% endif %}
                        {% endif %}
                        <!--/esthetique -->
                        </td>
                        
                        
                        
                        <td>
                            <p>
                             {% if is_assembly %}
                                <a href="#{{name}}">{{name}}<a>

                             {% else %}
                                {{name}}   
                             {% endif %}
                            </p>

                        </td>
                        <td class="order" >{{ord_quantity.order}}{{ord_quantity.order.errors }}</td>
                        <td class="quantity">{{ord_quantity.quantity}}{{ord_quantity.quantity.errors}}</td>
                        <td class="quantity">{{ord_quantity.unit}}{{ord_quantity.unit.errors}}</td>





                        {% if prefix %} <!-- else the part was defined in a previous assembly , make a href -->
                        <td class="cell_label part_type_form" id="{{prefix}}_ref">
                            {{ part_type.type_part }}
                        </td>

                        {% for field in part_doc_cforms.0 %} 

                            {% if field.name == "reference" or field.name == "name" or field.name == "revision" %}
                                <td class="{{field.errors|yesno:"errors,valid"}}">
                                    {{  field }} {{ field.errors }}
                                </td> 
                            {% endif %}

                        {% endfor %}

                        <td>
                            <button class="toggle_extra_attributes_button"
                                id="part_show-{{prefix}}"
                                >{{part_doc_cforms.0.errors|yesno:"-,+"}}</button> 
                        </td>
                    </tr>
                    
                    <tr class="part part_show-{{prefix}} show_hide" 
                        {% if not part_doc_cforms.0.errors %} style="display:none;" {% endif %}
                        >
                        <td class="|">
                        {% if not forloop.last %}| {% endif %}
                        </td>
                        <td class="vide" colspan="4">
                        </td>
                        <td colspan="5" id="extra_part_form-{{prefix}}"> 
                            {% with part_doc_cforms.0 as creation_form %}
                                {% include "extra_attributes.html" %}
                            {% endwith %}
                        </td>
                        
                        
                        
                        {% else %} <!--  href for the part already defined-->
                        
                         <td colspan="5"> 
                         <a href="#{{ref}}_ref">ya referenciado<a>
                         </td>
                        
                        
                        {% endif %}
                        
                        
                        
                    
                    
                    {% if prefix %} <!-- else nothing to show , the part was defined in a previous assembly  -->
                    <tr class="document">
                        <td class="|">
                        {% if not forloop.last %}| {% endif %}
                        </td>
                        <td class="vide" colspan="4">
                        </td>
                        
                        
                        
                        
                        <td class="cell_label">
                            <p>Document3D</p>
                        </td>
                        
                        {% for field in part_doc_cforms.1 %} 

                            {% if field.name == "reference" or field.name == "name" or field.name == "revision" %}
                                <td class="{{field.errors|yesno:"errors,valid"}}">
                                    {{  field }} {{ field.errors }}
                                </td> 
                            {% endif %}

                        {% endfor %}

                        <td>
                            <button class="toggle_extra_attributes_button"
                                id="doc_show-{{prefix}}"
                                >{{part_doc_cforms.1.errors|yesno:"-,+"}}</button> 
                        </td>

                    </tr> 
                     
                    <tr class="document doc_show-{{prefix}} show_hide" 
                    {% if not part_doc_cforms.1.errors %} style="display:none;" {% endif %}
                    >
                    
                    
                        <td class="|">
                        <!--esthetique -->
                        {% if not forloop.last %}| {% endif %}
                        <!--/esthetique -->
                        </td>
                        
                        
                        
                        <td class="vide" colspan="4">
                        </td>
                        <td colspan="5" id="extra_doc_form-{{prefix}}">
                            {% with part_doc_cforms.1 as creation_form %}
                                {% include "extra_attributes.html" %}
                            {% endwith %}
                        </td>

                    </tr> 
                
                

                                        
                    {% endif %}             
                    {% endfor %}

                             
        {% endfor %}
        {% endfor %}
        </table>
        <input type="submit" value="{% trans "Create" %}"/> 

    </form>       


{% endblock %}


